(this["webpackJsonpreact-typescript-starter-pack"]=this["webpackJsonpreact-typescript-starter-pack"]||[]).push([[0],{21:function(e,t,n){},23:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n.n(c),r=n(10),o=(n(19),n(20),n(21),n(4)),i=n(6),l=n(5),s=n(2),u=n(3),d=n.n(u),f="https://mate.academy/students-api";function j(e){return new Promise((function(t){setTimeout(t,e)}))}function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c={method:t};return n&&(c.body=JSON.stringify(n),c.headers={"Content-Type":"application/json; charset=UTF-8"}),j(300).then((function(){return fetch(f+e,c)})).then((function(e){if(!e.ok)throw new Error;return e.json()}))}var p,m=function(e){return b(e)},O=function(e,t){return b(e,"POST",t)},h=function(e,t){return b(e,"PATCH",t)},v=function(e){return b(e,"DELETE")},x=function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){var n;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m("/users?email=".concat(t));case 2:return n=e.sent,e.abrupt("return",n[0]||null);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){var n,c;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.email,c=t.name,e.abrupt("return",O("/users",{email:n,name:c}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=n(0),N=function(e){var t=e.onLogin,n=Object(c.useState)(""),a=Object(s.a)(n,2),r=a[0],l=a[1],u=Object(c.useState)(""),f=Object(s.a)(u,2),j=f[0],b=f[1],p=Object(c.useState)(!1),m=Object(s.a)(p,2),O=m[0],h=m[1],v=Object(c.useState)(!1),N=Object(s.a)(v,2),T=N[0],k=N[1],C=Object(c.useState)(""),E=Object(s.a)(C,2),_=E[0],S=E[1],w=function(e){localStorage.setItem("user",JSON.stringify(e)),t(e)};Object(c.useEffect)((function(){var e=localStorage.getItem("user");if(e)try{var n=JSON.parse(e);t(n)}catch(c){S("Need to login")}}),[]);var A=function(){var e=Object(i.a)(Object(o.a)().mark((function e(){var t;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(r);case 2:(t=e.sent)?w(t):h(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),S(""),k(!0),e.prev=3,!O){e.next=9;break}return e.next=7,y({name:j,email:r}).then(w);case 7:e.next=11;break;case 9:return e.next=11,A();case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),S("Something went wrtong");case 16:return e.prev=16,k(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[3,13,16,19]])})));return function(t){return e.apply(this,arguments)}}();return Object(g.jsxs)("form",{onSubmit:F,className:"box mt-5",children:[Object(g.jsx)("h1",{className:"title is-3",children:O?"You need to register":"Log in to open todos"}),Object(g.jsxs)("div",{className:"field",children:[Object(g.jsx)("label",{className:"label",htmlFor:"user-email",children:"Email"}),Object(g.jsxs)("div",{className:d()("control has-icons-left",{"is-loading":T}),children:[Object(g.jsx)("input",{type:"email",id:"user-email",className:d()("input",{"is-danger":!O&&_}),placeholder:"Enter your email",disabled:T||O,value:r,required:!0,onChange:function(e){return l(e.target.value)}}),Object(g.jsx)("span",{className:"icon is-small is-left",children:Object(g.jsx)("i",{className:"fas fa-envelope"})})]}),!O&&_&&Object(g.jsx)("p",{className:"help is-danger",children:_})]}),O&&Object(g.jsxs)("div",{className:"field",children:[Object(g.jsx)("label",{"aria-label":"name",className:"label",htmlFor:"user-name",children:"Your Name"}),Object(g.jsxs)("div",{className:d()("control has-icons-left",{"is-loading":T}),children:[Object(g.jsx)("input",{type:"text",id:"user-name",className:d()("input",{"is-danger":O&&_}),placeholder:"Enter your name",required:!0,minLength:4,disabled:T,value:j,onChange:function(e){return b(e.target.value)}}),Object(g.jsx)("span",{className:"icon is-small is-left",children:Object(g.jsx)("i",{className:"fas fa-user"})})]}),O&&_&&Object(g.jsx)("p",{className:"help is-danger",children:_})]}),Object(g.jsx)("div",{className:"field",children:Object(g.jsx)("button",{type:"submit",className:d()("button is-primary",{"is-loading":T}),children:O?"Register":"Login"})})]})},T=a.a.createContext(null),k=function(e){var t=e.children,n=Object(c.useState)(null),a=Object(s.a)(n,2),r=a[0],o=a[1];return r?Object(g.jsx)(T.Provider,{value:r,children:t}):Object(g.jsx)(N,{onLogin:o})},C=function(e){var t=e.query,n=e.setQuery,a=e.isAdding,r=e.handleSubmit,o=e.toggleAll,i=e.isCompletedAll,l=e.visibleTodos,s=Object(c.useRef)(null);return Object(c.useEffect)((function(){s.current&&s.current.focus()}),[]),Object(g.jsxs)("header",{className:"todoapp__header",children:[l.length>0&&Object(g.jsx)("button",{"data-cy":"ToggleAllButton",type:"button","aria-label":"toggle",className:d()("todoapp__toggle-all",{active:i}),onClick:o}),Object(g.jsx)("form",{onSubmit:function(e){e.preventDefault(),r()},children:Object(g.jsx)("input",{"data-cy":"NewTodoField",type:"text",ref:s,className:"todoapp__new-todo",placeholder:"What needs to be done?",value:t,onChange:function(e){return n(e.target.value)},disabled:!a})})]})},E=function(e){var t=e.todos,n=e.setFilterType,c=e.filterType,a=e.clearCompleted,r=e.completedTodos;return Object(g.jsx)(g.Fragment,{children:0!==t.length&&Object(g.jsxs)("footer",{className:"todoapp__footer","data-cy":"Footer",children:[Object(g.jsx)("span",{className:"todo-count","data-cy":"todosCounter",children:"".concat(t.length-r.length," items left")}),Object(g.jsxs)("nav",{className:"filter","data-cy":"Filter",children:[Object(g.jsx)("a",{"data-cy":"FilterLinkAll",href:"#/",className:d()("filter__link",{selected:"all"===c}),onClick:function(){return n("all")},children:"All"}),Object(g.jsx)("a",{"data-cy":"FilterLinkActive",href:"#/active",className:d()("filter__link",{selected:"active"===c}),onClick:function(){return n("active")},children:"Active"}),Object(g.jsx)("a",{"data-cy":"FilterLinkCompleted",href:"#/completed",className:d()("filter__link",{selected:"completed"===c}),onClick:function(){return n("completed")},children:"Completed"})]}),Object(g.jsx)("button",{"data-cy":"ClearCompletedButton",type:"button",className:"todoapp__clear-completed",onClick:a,style:{opacity:r.length>0?1:0},children:"Clear completed"})]})})},_=function(e){var t=e.visibleTodos,n=e.handleComplite,c=e.isEditing,a=e.onEditing,r=e.todoTitleField,o=e.editingValue,i=e.setEditingValue,l=e.setIsEditing,s=e.deleteTodo,u=e.loadTodoIds;return Object(g.jsx)("section",{className:"todoapp__main","data-cy":"TodoList",children:t.map((function(e){return Object(g.jsxs)("div",{"data-cy":"Todo",className:d()("todo",{completed:e.completed}),children:[Object(g.jsx)("label",{className:"todo__status-label",children:Object(g.jsx)("input",{"data-cy":"TodoStatus",type:"checkbox",className:"todo__status",onChange:function(){return n(e.id,e.completed)}})}),c===e.id?Object(g.jsx)("form",{onSubmit:function(t){t.preventDefault(),a(e.id)},children:Object(g.jsx)("input",{"data-cy":"TodoTitleField",ref:r,type:"text",className:"todo__title-field",placeholder:"Empty todo will be deleted",value:o,onChange:function(e){return i(e.currentTarget.value)},onBlur:function(){return a(e.id)}})}):Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)("span",{"data-cy":"TodoTitle",className:"todo__title",onDoubleClick:function(){l(e.id),i(e.title)},children:e.title}),Object(g.jsx)("button",{type:"button",className:"todo__remove","data-cy":"TodoDeleteButton",onClick:function(){return s(e.id)},children:"\xd7"})]}),Object(g.jsxs)("div",{"data-cy":"TodoLoader",className:d()("modal overlay",{"is-active":u.includes(e.id)}),children:[Object(g.jsx)("div",{className:"modal-background has-background-white-ter"}),Object(g.jsx)("div",{className:"loader"})]})]},e.id)}))})};!function(e){e[e.AddTodo=0]="AddTodo",e[e.DeleteTodo=1]="DeleteTodo",e[e.UpdateTodo=2]="UpdateTodo",e[e.Empty=3]="Empty"}(p||(p={}));var S=[{type:p.AddTodo,text:"Unable to add a todo"},{type:p.DeleteTodo,text:"Unable to delete a todo"},{type:p.UpdateTodo,text:"Unable to update a todo"},{type:p.Empty,text:"Title can't be empty"}],w=function(){var e=Object(c.useContext)(T),t=Object(c.useRef)(null),n=Object(c.useState)([]),a=Object(s.a)(n,2),r=a[0],u=a[1],f=Object(c.useState)(!0),j=Object(s.a)(f,2),b=j[0],x=j[1],y=Object(c.useState)(""),N=Object(s.a)(y,2),k=N[0],w=N[1],A=Object(c.useState)(null),F=Object(s.a)(A,2),L=F[0],D=F[1],I=Object(c.useState)([]),U=Object(s.a)(I,2),B=U[0],J=U[1],P=Object(c.useState)("all"),q=Object(s.a)(P,2),R=q[0],V=q[1],M=Object(c.useState)(!1),H=Object(s.a)(M,2),Q=H[0],Y=H[1],G=Object(c.useState)(null),W=Object(s.a)(G,2),z=W[0],K=W[1],X=Object(c.useState)(""),Z=Object(s.a)(X,2),$=Z[0],ee=Z[1];Object(c.useEffect)((function(){var t;e&&(t=e.id,m("/todos?userId=".concat(t))).then((function(e){return u(e)}))}),[]),Object(c.useEffect)((function(){t.current&&t.current.focus()}),[$,t]),Object(c.useEffect)((function(){var e=function(e){"Escape"===e.key&&K(null)};return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[]);var te=Object(c.useCallback)((function(e){var t=S.find((function(t){return t.type===e}));t&&D(t.text),setTimeout((function(){return D(null)}),3e3)}),[]),ne=Object(c.useCallback)((function(e){J((function(t){return[].concat(Object(l.a)(t),[e])})),D(null),function(e){return v("/todos/".concat(e))}(e).then((function(){u((function(t){return t.filter((function(t){return t.id!==e}))}))})).catch((function(){return te(p.DeleteTodo)})).finally((function(){return J((function(t){return t.filter((function(t){return t!==e}))}))}))}),[r]),ce=Object(c.useCallback)((function(e,t){var n,c;D(null),J((function(t){return[].concat(Object(l.a)(t),[e])})),(n=e,c={completed:!t},h("/todos/".concat(n),c)).then((function(t){u((function(n){return n.map((function(n){return n.id===e?t:n}))}))})).catch((function(){return te(p.UpdateTodo)})).finally((function(){return J((function(t){return t.filter((function(t){return e!==t}))}))}))}),[]),ae=Object(c.useCallback)(Object(i.a)(Object(o.a)().mark((function e(){var t;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(r.map((function(e){return e.completed===Q&&(J((function(t){return[].concat(Object(l.a)(t),[e.id])})),ce(e.id,e.completed)),e})));case 2:t=e.sent,u(t),Y((function(e){return!e}));case 5:case"end":return e.stop()}}),e)}))),[r]),re=Object(c.useMemo)((function(){switch(R){case"active":return r.filter((function(e){return!1===e.completed}));case"completed":return r.filter((function(e){return!0===e.completed}));default:return Object(l.a)(r)}}),[R,r]),oe=Object(c.useCallback)((function(e){D(null);var t=r.find((function(t){return t.id===e}));if((null===t||void 0===t?void 0:t.title)===$)return K(null),void J((function(t){return t.filter((function(t){return t!==e}))}));""!==$?(J((function(t){return[].concat(Object(l.a)(t),[e])})),function(e,t){return h("/todos/".concat(e),t)}(e,{title:$}).then((function(t){u((function(n){return n.map((function(n){return n.id===e?t:n}))}))})).catch((function(){return te(p.UpdateTodo)})).finally((function(){K(null),J((function(t){return t.filter((function(t){return t!==e}))}))}))):ne(e)}),[r,$]),ie=Object(c.useMemo)((function(){return Object(l.a)(re).filter((function(e){return!0===e.completed}))}),[Q,re]),le=Object(c.useMemo)((function(){return Object(l.a)(re).every((function(e){return!0===e.completed}))}),[Q,re]);return Object(g.jsxs)("div",{className:"todoapp",children:[Object(g.jsx)("h1",{className:"todoapp__title",children:"todos"}),Object(g.jsxs)("div",{className:"todoapp__content",children:[Object(g.jsx)(C,{query:k,setQuery:w,isAdding:b,handleSubmit:function(){(D(null),x(!1),""!==k)?e&&function(e){return O("/todos",e)}({title:k,userId:e.id,completed:!1}).then((function(e){J((function(t){return[].concat(Object(l.a)(t),[e.id])})),u((function(t){return[].concat(Object(l.a)(t),[e])}))})).catch((function(){return te(p.AddTodo)})).finally((function(){J((function(e){return e.slice(0,-1)})),w(""),x(!0)})):te(p.Empty)},toggleAll:ae,isCompletedAll:le,visibleTodos:re}),Object(g.jsx)(_,{visibleTodos:re,handleComplite:ce,isEditing:z,onEditing:oe,todoTitleField:t,editingValue:$,setEditingValue:ee,setIsEditing:K,deleteTodo:ne,loadTodoIds:B}),Object(g.jsx)(E,{todos:r,filterType:R,setFilterType:V,clearCompleted:function(){r.forEach((function(e){e.completed&&ne(e.id)}))},completedTodos:ie})]}),Object(g.jsxs)("div",{"data-cy":"ErrorNotification",className:d()("notification is-danger is-light has-text-weight-normal",{hidden:!L}),children:[Object(g.jsx)("button",{"data-cy":"HideErrorButton",type:"button",className:"delete",onClick:function(){return D(null)}}),L]})]})},A=function(){return Object(g.jsx)(k,{children:Object(g.jsx)(w,{})})};Object(r.createRoot)(document.getElementById("root")).render(Object(g.jsx)(A,{}))}},[[23,1,2]]]);
//# sourceMappingURL=main.56e30fa6.chunk.js.map